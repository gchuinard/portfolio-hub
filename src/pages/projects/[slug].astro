---
import Base from "../../layouts/Base.astro";
import { getCollection, getEntry } from "astro:content";

export async function getStaticPaths() {
  const entries = await getCollection("projects");
  return entries.map((p) => ({ params: { slug: p.slug } }));
}

const { slug } = Astro.params;
const project = await getEntry("projects", slug);
if (!project) return Astro.redirect("/projects");

const { Content } = await project.render();
const { title, description, tags = [], stack = [], image, date, demo, repo } = project.data;
---
<Base title={`${title} — Projet`} description={description}>
  <a href="/projects" class="text-sm text-zinc-400 hover:text-zinc-200">&larr; Retour aux projets</a>

  <!-- Header -->
  <header class="mt-3 flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
    <div>
      <h1 class="text-3xl font-semibold">{title}</h1>
      <p class="text-zinc-400 mt-1">{description}</p>
      <p class="text-xs text-zinc-500 mt-1">{date.toLocaleDateString("fr-FR")}</p>
      <div class="mt-3 flex flex-wrap gap-2">
        {tags.map(t => <span class="text-[11px] px-2 py-1 bg-zinc-800 rounded-full">{t}</span>)}
      </div>
      {stack.length > 0 && <p class="mt-2 text-sm text-zinc-500">{stack.join(" • ")}</p>}
    </div>

    <!-- Actions -->
    <div class="flex gap-3">
      {demo && <a href={demo} target="_blank" class="px-4 py-2 rounded-full bg-brand-600 text-white hover:opacity-90">Demo</a>}
      {repo && <a href={repo} target="_blank" class="px-4 py-2 rounded-full border border-zinc-700 hover:border-brand-500">Code</a>}
    </div>
  </header>

  <!-- Image -->
  {image && <img src={image} alt="" class="rounded-2xl mt-6 border border-zinc-800" />}

  <!-- Contenu markdown -->
  <article class="mt-6 prose prose-invert max-w-none">
    <Content />
  </article>
</Base>
